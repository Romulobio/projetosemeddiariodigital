<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal do Professor</title>
  <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles-professor.css">
</head>
<body>
  <!-- Cabe√ßalho -->
  <header class="header-professor">
    <div class="header-left">
      <img src="./img/logocd2.png" alt="Logo" class="logo-header">
      <div class="professor-info">
        <span id="nome-professor"></span>
        <span id="colegio-professor">Col√©gio Municipal Monsenhor Galv√£o</span>
      </div>
    </div>

    <div class="header-center">
      <div id="data-atual"></div>
    </div>

    <div class="header-right">
      <button onclick="toggleMenu()">‚ò∞ Menu</button>
      <div id="dropdownMenu" class="dropdown-menu">
        <a href="#" onclick="sair()">Sair</a>
      </div>
    </div>
  </header>

  <!-- Conte√∫do principal -->
  <main class="conteudo">
    <h1>Bem-vindo ao Portal do Professor</h1>

    <div class="botoes-funcionalidades">
      <div class="botao" onclick="abrirFrequencia()">üìä Frequ√™ncia</div>
      <div class="botao" onclick="abrirDiario()">üè´ Di√°rio Digital</div>
      <div class="botao" onclick="abrirRelatorios()">üìà Relat√≥rios</div>
      <div class="botao" onclick="abrirnotas()">üóìÔ∏è Cronograma de Notas</div>
    </div>
  </main>

  <!-- Rodap√© -->
  <footer>
    ¬© 2025 - Portal do Professor | Sistema Escolar Integrado
  </footer>

  <!-- Scripts -->
  <script>
    // ===============================
    // Verifica√ß√£o do Professor Logado
    // ===============================
    function verificarProfessor() {
      const usuario = JSON.parse(localStorage.getItem('usuarioLogado'));
      if (!usuario || usuario.tipo !== 'professor') {
        window.location.href = 'index.html';
      }
      document.getElementById('nome-professor').textContent = usuario.nome;
      atualizarData();
    }

    // ===============================
    // Exibe Data Atual no Cabe√ßalho
    // ===============================
    function atualizarData() {
      const data = new Date();
      const opcoes = { day: '2-digit', month: 'long', year: 'numeric' };
      document.getElementById('data-atual').textContent =
        data.toLocaleDateString('pt-BR', opcoes);
    }

    // ===============================
    // Bot√µes de Navega√ß√£o
    // ===============================
    function abrirFrequencia() { window.location.href = 'frequencia.html'; }
    function abrirDiario() { window.location.href = 'diario.html'; }
    function abrirRelatorios() { window.location.href = 'relatorios.html'; }
    function abrirnotas() { window.location.href = 'notas.html'; }

    // ===============================
    // Fun√ß√µes Gerais
    // ===============================
    function sair() {
      localStorage.removeItem('usuarioLogado');
      window.location.href = 'index.html';
    }

    function toggleMenu() {
      const menu = document.getElementById('dropdownMenu');
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    document.addEventListener('DOMContentLoaded', verificarProfessor);

// Fun√ß√£o para verificar se o professor est√° logado (ATUALIZADA)
async function verificarProfessor() {
  const usuario = JSON.parse(localStorage.getItem('usuarioLogado'));
  
  if (!usuario || usuario.tipo !== 'professor') {
    window.location.href = 'index.html';
    return;
  }
  
  // Verifica no servidor se a sess√£o ainda √© v√°lida
  try {
    const response = await fetch(`${API_URL}/api/dados-usuario`, {
      credentials: 'include' // importante para enviar a sess√£o
    });
    
    if (!response.ok) {
      throw new Error('Sess√£o expirada');
    }
    
    document.getElementById('nome-professor').textContent = usuario.nome;
    atualizarData();
  } catch (error) {
    console.error('Erro ao verificar sess√£o:', error);
    localStorage.removeItem('usuarioLogado');
    window.location.href = 'index.html';
  }
}

// Fun√ß√£o para fazer logout (ATUALIZADA)
async function sair() {
  try {
    await fetch(`${API_URL}/logout`, {
      method: 'POST',
      credentials: 'include'
    });
  } catch (error) {
    console.error('Erro no logout:', error);
  } finally {
    localStorage.removeItem('usuarioLogado');
    window.location.href = 'index.html';
  }
}

// Substitua a fun√ß√£o verificarProfessor existente
document.addEventListener('DOMContentLoaded', verificarProfessor);


</script>

<script>
// ‚úÖ CORRE√á√ÉO: URL autom√°tica para produ√ß√£o/desenvolvimento
const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
  ? 'http://localhost:3000'
  : 'http://projetosemeddiariodigital-production.up.railway.app'; // ‚ö†Ô∏è SUBSTITUA pelo URL REAL do Railway depois!

// Fun√ß√£o auxiliar para fetch com tratamento de erro
async function apiFetch(url, options = {}) {
  try {
    const response = await fetch(`${API_URL}${url}`, {
      ...options,
      credentials: 'include'
    });
    return response;
  } catch (error) {
    console.error('Erro na requisi√ß√£o:', error);
    throw error;
  }
}
</script>

<script src="script-pagina-professor.js"></script>

</body>
</html>
